#!/usr/bin/env bash
# Usage: wp-plugins [project] [options]
# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞–º–∏ WordPress –ø—Ä–æ–µ–∫—Ç–∞

set -euo pipefail

PROJECT="${1:-}"
OPTION="${2:-}"

# –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–ª–∞–≥–∏–Ω–∞–º–∏
log() { printf "‚û° %s\n" "$*"; }
ok()  { printf "‚úì %s\n" "$*"; }
err() { printf "‚úó %s\n" "$*" >&2; }

# –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
show_help() {
  cat <<'HELP'
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 WP PLUGINS MANAGER

 –û–±—â–∏–µ –∫–æ–º–∞–Ω–¥—ã:
   wp-plugins --help          ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É
   wp-plugins --keys          ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –ª–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã–µ –∫–ª—é—á–∏
   wp-plugins --list          ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–ª–∞–≥–∏–Ω–æ–≤ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏

 –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞:
   wp-plugins <project>       ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ø–ª–∞–≥–∏–Ω—ã –≤ –ø—Ä–æ–µ–∫—Ç
   wp-plugins <project> --list ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ

 –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
   ~/Sites/wp-tools/plugins/plugins.txt    ‚Äî —Å–ø–∏—Å–æ–∫ –ø–ª–∞–≥–∏–Ω–æ–≤
   ~/Sites/wp-tools/plugins/licenses.txt   ‚Äî –ª–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã–µ –∫–ª—é—á–∏
   ~/Sites/wp-tools/plugins/*.zip          ‚Äî –∞—Ä—Ö–∏–≤—ã –ø–ª–∞–≥–∏–Ω–æ–≤

 –ü—Ä–∏–º–µ—Ä plugins.txt:
   classic-editor
   query-monitor
   contact-form-7

 –ü—Ä–∏–º–µ—Ä licenses.txt:
   seo-by-rank-math=your-license-key-here
   wp-super-cache=your-license-key-here

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
HELP
}

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–ø—Ü–∏–∏ –ø–æ–º–æ—â–∏
if [[ "${PROJECT}" == "--help" ]] || [[ "${PROJECT}" == "-h" ]] || [[ "${PROJECT}" == "--keys" ]] || [[ "${PROJECT}" == "--list" ]]; then
  OPTION="${PROJECT}"
  PROJECT=""
fi

BASE_DIR="${HOME}/Sites"
PLUGINS_DIR="${HOME}/Sites/wp-tools/plugins"

# –ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –Ω–µ —É–∫–∞–∑–∞–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—â–∏–µ –∫–æ–º–∞–Ω–¥—ã
if [[ -z "${PROJECT}" ]]; then
  # –ï—Å–ª–∏ —ç—Ç–æ –æ–±—â–∞—è –∫–æ–º–∞–Ω–¥–∞ (--help, --keys, --list), –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
  if [[ "${OPTION}" == "--help" ]] || [[ "${OPTION}" == "--keys" ]] || [[ "${OPTION}" == "--list" ]]; then
    # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
    :
  else
    echo "Usage: wp-plugins [project] [options]"
    echo "–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—â–∏–µ –∫–æ–º–∞–Ω–¥—ã: wp-plugins --help"
    echo ""
    echo "–û–±—â–∏–µ –∫–æ–º–∞–Ω–¥—ã:"
    echo "  --help           - –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É"
    echo "  --keys           - –ø–æ–∫–∞–∑–∞—Ç—å –ª–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã–µ –∫–ª—é—á–∏"
    echo "  --list           - –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–ª–∞–≥–∏–Ω–æ–≤ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏"
    echo ""
    echo "–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞:"
    echo "  <project>        - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–ª–∞–≥–∏–Ω—ã –≤ –ø—Ä–æ–µ–∫—Ç"
    echo "  <project> --list - –ø–æ–∫–∞–∑–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ"
    exit 64
  fi
else
  # –ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç —É–∫–∞–∑–∞–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  PROJ_DIR="${BASE_DIR}/${PROJECT}"
  if [[ ! -d "${PROJ_DIR}" ]]; then
    echo "‚úó –ü—Ä–æ–µ–∫—Ç '${PROJECT}' –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ ${BASE_DIR}"
    exit 1
  fi
  
  if [[ ! -f "${PROJ_DIR}/.ddev/config.yaml" ]]; then
    echo "‚úó '${PROJECT}' –Ω–µ —è–≤–ª—è–µ—Ç—Å—è DDEV –ø—Ä–æ–µ–∫—Ç–æ–º"
    exit 1
  fi
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–∞–ø–∫–∞ —Å –ø–ª–∞–≥–∏–Ω–∞–º–∏
if [[ ! -d "${PLUGINS_DIR}" ]]; then
  echo "‚úó –ü–∞–ø–∫–∞ —Å –ø–ª–∞–≥–∏–Ω–∞–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: ${PLUGINS_DIR}"
  echo "–°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É –∏ –¥–æ–±–∞–≤—å—Ç–µ —Ñ–∞–π–ª—ã plugins.txt –∏ licenses.txt"
  exit 1
fi

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç —É–∫–∞–∑–∞–Ω
if [[ -n "${PROJECT}" ]]; then
  cd "${PROJ_DIR}"
  
  # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω –ª–∏ –ø—Ä–æ–µ–∫—Ç
  if ! ddev describe >/dev/null 2>&1; then
    echo "‚Üí –ü—Ä–æ–µ–∫—Ç '${PROJECT}' –Ω–µ –∑–∞–ø—É—â–µ–Ω. –ó–∞–ø—É—Å–∫–∞—é..."
    ddev start
  fi
fi

# –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–ª–∞–≥–∏–Ω–æ–≤
show_plugins_list() {
  echo "‚Üí –°–ø–∏—Å–æ–∫ –ø–ª–∞–≥–∏–Ω–æ–≤ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏:"
  echo ""
  
  if [[ -f "${PLUGINS_DIR}/plugins.txt" ]]; then
    echo "üì¶ –ü–ª–∞–≥–∏–Ω—ã –∏–∑ —Ñ–∞–π–ª–∞ plugins.txt:"
    grep -v '^#' "${PLUGINS_DIR}/plugins.txt" | grep -v '^$' | sed 's/^/  - /'
  else
    echo "‚úó –§–∞–π–ª plugins.txt –Ω–µ –Ω–∞–π–¥–µ–Ω"
  fi
  
  echo ""
  echo "üìÅ –ê—Ä—Ö–∏–≤—ã –ø–ª–∞–≥–∏–Ω–æ–≤:"
  if ls "${PLUGINS_DIR}"/*.zip >/dev/null 2>&1; then
    ls "${PLUGINS_DIR}"/*.zip | sed 's/.*\//  - /' | sed 's/\.zip$//'
  else
    echo "  (–∞—Ä—Ö–∏–≤—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã)"
  fi
  
  echo ""
  echo "üîë –õ–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã–µ –∫–ª—é—á–∏:"
  if [[ -f "${PLUGINS_DIR}/licenses.txt" ]]; then
    grep -v '^#' "${PLUGINS_DIR}/licenses.txt" | grep -v '^$' | grep '=' | sed 's/^/  - /'
  else
    echo "  (—Ñ–∞–π–ª licenses.txt –Ω–µ –Ω–∞–π–¥–µ–Ω)"
  fi
}

# –ü–æ–∫–∞–∑–∞—Ç—å –ª–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã–µ –∫–ª—é—á–∏
show_licenses() {
  echo "‚Üí –õ–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã–µ –∫–ª—é—á–∏:"
  echo ""
  
  if [[ ! -f "${PLUGINS_DIR}/licenses.txt" ]]; then
    echo "‚úó –§–∞–π–ª licenses.txt –Ω–µ –Ω–∞–π–¥–µ–Ω"
    return 1
  fi
  
  echo "üîë –î–æ—Å—Ç—É–ø–Ω—ã–µ –ª–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã–µ –∫–ª—é—á–∏:"
  echo ""
  
  # –ß–∏—Ç–∞–µ–º –ª–∏—Ü–µ–Ω–∑–∏–∏ –∏–∑ —Ñ–∞–π–ª–∞
  while IFS='=' read -r plugin_slug license_key; do
    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
    if [[ "${plugin_slug}" =~ ^#.*$ ]] || [[ -z "${plugin_slug}" ]]; then
      continue
    fi
    
    echo "  ${plugin_slug}: ${license_key}"
  done < "${PLUGINS_DIR}/licenses.txt"
  
  echo ""
  echo "‚ÑπÔ∏è  –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –Ω—É–∂–Ω—ã–µ –∫–ª—é—á–∏ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –ª–∏—Ü–µ–Ω–∑–∏–∏ –≤ –∞–¥–º–∏–Ω–∫–µ WordPress"
}

# –ü–æ–∫–∞–∑–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ
show_installed_plugins() {
  echo "‚Üí –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ '${PROJECT}':"
  echo ""
  
  if ! ddev describe >/dev/null 2>&1; then
    echo "‚úó –ü—Ä–æ–µ–∫—Ç '${PROJECT}' –Ω–µ –∑–∞–ø—É—â–µ–Ω"
    return 1
  fi
  
  echo "üìä –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã:"
  ddev wp plugin list --status=active --format=table
  
  echo ""
  echo "üìä –í—Å–µ –ø–ª–∞–≥–∏–Ω—ã:"
  ddev wp plugin list --format=table
}

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–ª–∞–≥–∏–Ω—ã
install_plugins() {
  echo "‚Üí –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–≥–∏–Ω–æ–≤ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ '${PROJECT}':"
  echo ""
  
  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–ª–∞–≥–∏–Ω—ã –∏–∑ –∞—Ä—Ö–∏–≤–∞
  if ls "${PLUGINS_DIR}"/*.zip >/dev/null 2>&1; then
    echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –ø–ª–∞–≥–∏–Ω—ã –∏–∑ –∞—Ä—Ö–∏–≤–æ–≤..."
    for zip_file in "${PLUGINS_DIR}"/*.zip; do
      plugin_name=$(basename "${zip_file}" .zip)
      echo "  ‚Üí –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é ${plugin_name}..."
      
      if ddev wp plugin is-installed "${plugin_name}" >/dev/null 2>&1; then
        echo "    ‚úì –ü–ª–∞–≥–∏–Ω —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
      else
        # –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –∞—Ä—Ö–∏–≤ –≤ –ø–∞–ø–∫—É –ø–ª–∞–≥–∏–Ω–æ–≤
        echo "    ‚Üí –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞—é –∞—Ä—Ö–∏–≤..."
        if cd wp-content/plugins && unzip -o "${zip_file}" >/dev/null 2>&1; then
          echo "    ‚úì –ü–ª–∞–≥–∏–Ω —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω"
          echo "    ‚úì –ü–ª–∞–≥–∏–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        else
          echo "    ‚úó –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å –∞—Ä—Ö–∏–≤"
        fi
        cd ../..
      fi
    done
    echo ""
  fi
  
  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–ª–∞–≥–∏–Ω—ã –∏–∑ –º–∞—Ä–∫–µ—Ç–∞
  if [[ -f "${PLUGINS_DIR}/plugins.txt" ]]; then
    echo "üåê –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –ø–ª–∞–≥–∏–Ω—ã –∏–∑ WordPress –º–∞—Ä–∫–µ—Ç–∞..."
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–ª–∞–≥–∏–Ω–æ–≤
    plugins_list=$(grep -v '^#' "${PLUGINS_DIR}/plugins.txt" | grep -v '^$')
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–∂–¥—ã–π –ø–ª–∞–≥–∏–Ω
    for plugin_slug in $plugins_list; do
      echo "  ‚Üí –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é ${plugin_slug}..."
      
      if ddev wp plugin is-installed "${plugin_slug}" >/dev/null 2>&1; then
        echo "    ‚úì –ü–ª–∞–≥–∏–Ω —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
      else
        if ddev wp plugin install "${plugin_slug}" 2>/dev/null; then
          echo "    ‚úì –ü–ª–∞–≥–∏–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        else
          echo "    ‚úó –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–ª–∞–≥–∏–Ω"
        fi
      fi
    done
  else
    echo "‚úó –§–∞–π–ª plugins.txt –Ω–µ –Ω–∞–π–¥–µ–Ω: ${PLUGINS_DIR}/plugins.txt"
  fi
  
  echo ""
  ok "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–≥–∏–Ω–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
  echo ""
  echo "üìä –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã:"
  ddev wp plugin list --status=active
  
  echo ""
  echo "üîë –õ–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏:"
  if [[ -f "${PLUGINS_DIR}/licenses.txt" ]]; then
    # –ß–∏—Ç–∞–µ–º –ª–∏—Ü–µ–Ω–∑–∏–∏ –∏–∑ —Ñ–∞–π–ª–∞
    while IFS='=' read -r plugin_slug license_key; do
      # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
      if [[ "${plugin_slug}" =~ ^#.*$ ]] || [[ -z "${plugin_slug}" ]]; then
        continue
      fi
      echo "  ${plugin_slug}: ${license_key}"
    done < "${PLUGINS_DIR}/licenses.txt"
    echo ""
    echo "‚ÑπÔ∏è  –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –Ω—É–∂–Ω—ã–µ –∫–ª—é—á–∏ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –ª–∏—Ü–µ–Ω–∑–∏–∏ –≤ –∞–¥–º–∏–Ω–∫–µ WordPress"
  else
    echo "  (—Ñ–∞–π–ª licenses.txt –Ω–µ –Ω–∞–π–¥–µ–Ω)"
  fi
}

# –û–±–Ω–æ–≤–∏—Ç—å –∞—Ä—Ö–∏–≤—ã –ø–ª–∞–≥–∏–Ω–æ–≤
update_plugin_archives() {
  echo "‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏–≤–æ–≤ –ø–ª–∞–≥–∏–Ω–æ–≤..."
  echo ""
  echo "‚ÑπÔ∏è  –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞—Ä—Ö–∏–≤–æ–≤:"
  echo "  1. –°–∫–∞—á–∞–π—Ç–µ –Ω–æ–≤—ã–µ –≤–µ—Ä—Å–∏–∏ –ø–ª–∞–≥–∏–Ω–æ–≤"
  echo "  2. –ó–∞–º–µ–Ω–∏—Ç–µ —Ñ–∞–π–ª—ã –≤ ${PLUGINS_DIR}/"
  echo "  3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É: wp-plugins ${PROJECT}"
}

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø—Ü–∏–π
case "${OPTION}" in
  --help)
    show_help
    exit 0
    ;;
  --keys)
    show_licenses
    exit 0
    ;;
  --list)
    if [[ -n "${PROJECT}" ]]; then
      # –ü–æ–∫–∞–∑–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ
      show_installed_plugins
    else
      # –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–ª–∞–≥–∏–Ω–æ–≤ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏
      show_plugins_list
    fi
    exit 0
    ;;
  --update)
    update_plugin_archives
    exit 0
    ;;
  "")
    if [[ -n "${PROJECT}" ]]; then
      # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–ª–∞–≥–∏–Ω—ã –≤ –ø—Ä–æ–µ–∫—Ç
      install_plugins
    else
      echo "‚úó –£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–ª–∞–≥–∏–Ω–æ–≤"
      echo "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: wp-plugins <project>"
      exit 1
    fi
    exit 0
    ;;
  *)
    echo "‚úó –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ–ø—Ü–∏—è: ${OPTION}"
    echo "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ --help –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏"
    exit 1
    ;;
esac
